<%- include('partials/header') %>

<style>
  /* Tinh chỉnh nhỏ cho phần 'Khám phá theo loại phòng' */
  .discover-section { background:#f8fbff; padding:34px 0; }
  .discover-grid { display:flex; gap:28px; align-items:flex-start; }
  .discover-left { flex:1.2; }
  .discover-right { flex:1; display:flex; flex-direction:column; gap:14px; }
  .discover-img { width:100%; height:380px; object-fit:cover; border-radius:14px; box-shadow:0 12px 36px rgba(2,132,199,.08); transition:all .35s ease; }
  .type-chip { border-radius:999px; padding:.45rem .8rem; border:1px solid #c7e9ff; background:transparent; color:#0369a1; cursor:pointer; transition:.18s; }
  .type-chip.active { background:#0ea5e9; color:#fff; border-color:#0ea5e9; box-shadow:0 10px 28px rgba(14,165,233,.12); transform:translateY(-3px); }
  .type-card { background:#fff; padding:12px; border-radius:12px; box-shadow:0 10px 22px rgba(2,132,199,.04); display:flex; gap:12px; align-items:flex-start; transition:.18s; }
  .type-card:hover { transform:translateY(-6px); box-shadow:0 18px 40px rgba(2,132,199,.10); }
  .type-icon { width:56px; height:56px; border-radius:12px; display:flex; align-items:center; justify-content:center; background:linear-gradient(135deg,#e6f7ff,#dbeafe); color:#0369a1; font-weight:700; }
  @media (max-width:980px) {
    .discover-grid { flex-direction:column; }
    .discover-img { height:220px; }
  }
</style>

<section class="container py-5">
  <div class="row align-items-center">
    <div class="col-lg-6">
      <h1 class="display-5 fw-bold">Đặt phòng nhanh – đẹp – minh bạch</h1>
      <p class="text-muted">Chọn ngày, lọc theo tên phòng/giá và đặt ngay. Giá hiển thị rõ ràng, xác nhận tức thì.</p>

      <!-- form tìm kiếm (đã bỏ địa điểm) -->
      <form action="/search" method="get" class="row g-2 bg-white p-3 rounded shadow-sm">
        <div class="col-12 col-md-6">
          <label class="form-label small text-muted">Từ khóa</label>
          <input class="form-control" type="text" name="q" placeholder="Deluxe, D101, ...">
        </div>
        <div class="col-6 col-md-3">
          <label class="form-label small text-muted">Loại phòng</label>
          <select name="type" class="form-select">
            <option value="">Tất cả</option>
            <option value="Standard">Standard</option>
            <option value="Superior">Superior</option>
            <option value="Deluxe">Deluxe</option>
            <option value="Suite">Suite</option>
          </select>
        </div>
        <div class="col-6 col-md-3">
          <label class="form-label small text-muted">Giá từ</label>
          <input class="form-control" type="number" name="minPrice" min="0">
        </div>
        <div class="col-6 col-md-3">
          <label class="form-label small text-muted">Giá đến</label>
          <input class="form-control" type="number" name="maxPrice" min="0">
        </div>
        <div class="col-6 col-md-3">
          <label class="form-label small text-muted">Nhận phòng</label>
          <input class="form-control" type="date" name="checkIn" id="checkIn">
        </div>
        <div class="col-6 col-md-3">
          <label class="form-label small text-muted">Trả phòng</label>
          <input class="form-control" type="date" name="checkOut" id="checkOut">
        </div>
        <div class="col-12 col-md-3">
          <button class="btn btn-info w-100 text-white mt-2" type="submit">Tìm phòng</button>
        </div>
      </form>
    </div>

    <div class="col-lg-6">
      <div class="ratio ratio-16x9 rounded-4 overflow-hidden">
        <img src="/images/hotel-banner.jpg" onerror="this.src='/images/room1.jpeg'" alt="banner" class="w-100 h-100 object-fit-cover">
      </div>
    </div>
  </div>
</section>

<!-- Khám phá theo loại phòng -->
<section class="discover-section">
  <div class="container">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h3 class="text-primary fw-bold">Khám phá theo loại phòng</h3>
      <div class="d-flex gap-2">
        <button class="type-chip" data-key="standard">Standard</button>
        <button class="type-chip" data-key="superior">Superior</button>
        <button class="type-chip" data-key="deluxe">Deluxe</button>
        <button class="type-chip" data-key="suite">Suite</button>
      </div>
    </div>

    <div class="discover-grid">
      <div class="discover-left">
        <img id="discoverMainImg" class="discover-img" src="/images/room-explore.jpg" alt="explore" onerror="this.src='/images/room1.jpeg'">
      </div>

      <div class="discover-right">
        <div id="card-standard" class="type-card">
          <div class="type-icon">S</div>
          <div>
            <h5 class="mb-1">Standard <span class="badge bg-light text-muted">Hạng cơ bản</span></h5>
            <p class="text-muted small">Hạng cơ bản, diện tích vừa phải, tiện nghi tiêu chuẩn. Phù hợp cho khách muốn tiết kiệm.</p>
          </div>
        </div>

        <div id="card-superior" class="type-card">
          <div class="type-icon">SP</div>
          <div>
            <h5 class="mb-1">Superior <span class="badge bg-light text-muted">Hạng trung</span></h5>
            <p class="text-muted small">Phòng rộng hơn, trang trí đẹp, phù hợp khách công tác và cặp đôi.</p>
          </div>
        </div>

        <div id="card-deluxe" class="type-card">
          <div class="type-icon">DX</div>
          <div>
            <h5 class="mb-1">Deluxe <span class="badge bg-light text-muted">Hạng cao</span></h5>
            <p class="text-muted small">View đẹp, nội thất cao cấp hơn, phù hợp khách du lịch muốn trải nghiệm.</p>
          </div>
        </div>

        <div id="card-suite" class="type-card">
          <div class="type-icon">ST</div>
          <div>
            <h5 class="mb-1">Suite <span class="badge bg-light text-muted">Hạng sang</span></h5>
            <p class="text-muted small">Hạng sang, phòng khách riêng, dịch vụ cao cấp.</p>
          </div>
        </div>

      </div>
    </div>
  </div>
</section>

<!-- Featured rooms (giữ nguyên các include hiện có trong project) -->
<section class="container py-5">
  <h3 class="text-primary fw-bold mb-3">Phòng nổi bật</h3>

  <div class="row g-4">
    <% if (rooms && rooms.length) { %>
      <% rooms.forEach(r => { %>
        <div class="col-sm-6 col-lg-4">
          <a href="/user/room/<%= r._id %>" class="text-decoration-none text-dark">
            <div class="card h-100 border-0 shadow-sm rounded-4">
              <img src="<%= (r.image && (r.image.startsWith('/images/') || r.image.startsWith('http'))) ? r.image : (r.image ? '/images/' + r.image : '/images/room1.jpeg') %>"
                   class="card-img-top rounded-top-4" style="height:220px;object-fit:cover" alt="room" onerror="this.src='/images/room1.jpeg'">
              <div class="card-body">
                <h6 class="fw-bold mb-1"><%= r.name || (r.type + ' - ' + r.roomNumber) %></h6>
                <div class="d-flex justify-content-between align-items-center">
                  <div class="text-info fw-bold"><%= (r.price||0).toLocaleString() %>₫/đêm</div>
                  <div class="small text-muted"><%= r.type || '' %></div>
                </div>
              </div>
            </div>
          </a>
        </div>
      <% }) %>
    <% } else { %>
      <div class="col-12 text-muted">Hiện chưa có phòng khả dụng.</div>
    <% } %>
  </div>
</section>

<%- include('partials/footer') %>

<script>
  (function(){
    const imgs = {
      standard: '/images/Standard.jpg',
      superior: '/images/Superior.jpg',
      deluxe: '/images/Deluxe.jpg',
      suite: '/images/Suite.jpg'
    };
    document.querySelectorAll('.type-chip').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        document.querySelectorAll('.type-chip').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        const key = btn.dataset.key;
        const img = document.getElementById('discoverMainImg');
        if(img){
          img.style.opacity = 0;
          setTimeout(()=>{ img.src = imgs[key] || '/images/room-explore.jpg'; img.style.opacity = 1; }, 180);
        }
      });
    });

    const today = new Date().toISOString().split('T')[0];
    const inEl = document.getElementById('checkIn');
    const outEl = document.getElementById('checkOut');
    if(inEl) inEl.min = today;
    if(outEl) outEl.min = today;
    if(inEl && outEl) inEl.addEventListener('change', ()=> outEl.min = inEl.value || today);
  })();
</script>

<%- include('partials/header') %>

<section class="py-4 bg-light">
  <div class="container">
    <h1 class="h3 fw-bold mb-3">Tìm kiếm phòng</h1>

    <form class="card shadow-sm p-3 mb-4" action="/search" method="GET">
      <div class="row g-3 align-items-end">

        <div class="col-md-4">
          <label class="form-label">Từ khóa (tên/mã/loại/địa điểm)</label>
          <input type="text" class="form-control" name="q" value="<%= (query && query.q) || '' %>" placeholder="Deluxe, D101, Hà Nội...">
        </div>

        <div class="col-md-2">
          <label class="form-label">Loại phòng</label>
          <select class="form-select" name="type">
            <option value="">Tất cả</option>
            <option value="Standard" <%= query && query.type==='Standard' ? 'selected' : '' %>>Standard</option>
            <option value="Superior" <%= query && query.type==='Superior' ? 'selected' : '' %>>Superior</option>
            <option value="Deluxe"   <%= query && query.type==='Deluxe'   ? 'selected' : '' %>>Deluxe</option>
            <option value="Suite"    <%= query && query.type==='Suite'    ? 'selected' : '' %>>Suite</option>
          </select>
        </div>

        <div class="col-md-2">
          <label class="form-label">Địa điểm</label>
          <input type="text" class="form-control" name="city" value="<%= (query && query.city) || '' %>" placeholder="Hà Nội, Đà Nẵng...">
        </div>

        <div class="col-md-2">
          <label class="form-label">Giá từ</label>
          <input type="number" class="form-control" name="min" value="<%= (query && query.min) || '' %>" placeholder="500000">
        </div>

        <div class="col-md-2">
          <label class="form-label">Giá đến</label>
          <input type="number" class="form-control" name="max" value="<%= (query && query.max) || '' %>" placeholder="2000000">
        </div>

        <div class="col-md-3">
          <label class="form-label">Nhận phòng</label>
          <input type="date" class="form-control" name="checkIn" value="<%= (query && query.checkIn) || '' %>">
        </div>

        <div class="col-md-3">
          <label class="form-label">Trả phòng</label>
          <input type="date" class="form-control" name="checkOut" value="<%= (query && query.checkOut) || '' %>">
        </div>

        <div class="col-md-2">
          <label class="form-label">Sắp xếp</label>
          <select class="form-select" name="sort">
            <option value="priceAsc"  <%= query && query.sort==='priceAsc'  ? 'selected' : '' %>>Giá tăng dần</option>
            <option value="priceDesc" <%= query && query.sort==='priceDesc' ? 'selected' : '' %>>Giá giảm dần</option>
            <option value="nameAsc"   <%= query && query.sort==='nameAsc'   ? 'selected' : '' %>>Tên A → Z</option>
            <option value="nameDesc"  <%= query && query.sort==='nameDesc'  ? 'selected' : '' %>>Tên Z → A</option>
          </select>
        </div>

        <div class="col-md-2">
          <button class="btn btn-primary w-100">Tìm phòng</button>
        </div>
      </div>
    </form>

    <div class="d-flex justify-content-between align-items-center mb-2">
      <h2 class="h5 fw-bold mb-0">Kết quả</h2>
      <span class="badge text-bg-info">Tìm thấy <%= total || 0 %> phòng</span>
    </div>

    <% if ((rooms || []).length === 0) { %>
      <div class="alert alert-warning">Chưa có kết quả phù hợp. Hãy thử thay đổi bộ lọc.</div>
    <% } %>

    <div class="row g-4">
      <% (rooms || []).forEach(function(r) { %>
        <div class="col-md-6 col-lg-4">
          <div class="card h-100 shadow-sm border-0">
            <img src="/images/room1.jpeg" class="card-img-top" alt="<%= r.name || r.type %>">
            <div class="card-body">
              <h5 class="card-title mb-1"><%= r.name || (r.type + ' - ' + (r.code || '')) %></h5>
              <div class="small text-muted mb-2">
                <%= r.city || '—' %> · <%= r.type || '—' %>
              </div>
              <div class="fw-semibold text-primary">Giá: <%= (r.price || 0).toLocaleString('vi-VN') %> đ/đêm</div>
            </div>
            <div class="card-footer bg-white border-0">
              <a href="/booking?id=<%= r._id %>" class="btn btn-outline-primary w-100">Đặt ngay</a>
            </div>
          </div>
        </div>
      <% }) %>
    </div>
  </div>
</section>

<%- include('partials/footer') %>

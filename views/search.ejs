<%- include('partials/header') %>

<div class="container mt-4">
  <h2 class="page-title">T√¨m ki·∫øm ph√≤ng</h2>

  <!-- SEARCH CARD -->
  <form id="searchForm" method="get" action="/search" class="card search-card mb-4 shadow-lg">
    <div class="search-inner">
      <div class="row gx-3 gy-3 align-items-end">

        <div class="col-lg-5 col-md-12">
          <label class="form-label">T·ª´ kh√≥a (t√™n/m√£/lo·∫°i)</label>
          <input class="form-control" name="q" value="<%= typeof q !== 'undefined' ? q : '' %>" placeholder="Deluxe, D101...">
        </div>

        <div class="col-lg-2 col-md-6">
          <label class="form-label">Lo·∫°i ph√≤ng</label>
          <select class="form-select" name="type">
            <option value="" <%= (type === '') ? 'selected' : '' %>>T·∫•t c·∫£</option>
            <option value="Standard" <%= type === 'Standard' ? 'selected' : '' %>>Standard</option>
            <option value="Superior" <%= type === 'Superior' ? 'selected' : '' %>>Superior</option>
            <option value="Deluxe" <%= type === 'Deluxe' ? 'selected' : '' %>>Deluxe</option>
            <option value="Suite" <%= type === 'Suite' ? 'selected' : '' %>>Suite</option>
          </select>
        </div>

        <div class="col-lg-2 col-md-6">
          <label class="form-label">Gi√° t·ª´</label>
          <input class="form-control" name="min" inputmode="numeric" value="<%= typeof min !== 'undefined' ? min : '' %>" placeholder="V√≠ d·ª•: 100000">
        </div>

        <div class="col-lg-2 col-md-6">
          <label class="form-label">Gi√° ƒë·∫øn</label>
          <input class="form-control" name="max" inputmode="numeric" value="<%= typeof max !== 'undefined' ? max : '' %>" placeholder="V√≠ d·ª•: 500000">
        </div>

        <div class="col-lg-1 col-md-6 d-flex justify-content-lg-end">
          <button type="submit" class="btn btn-accent btn-search w-100">T√¨m<br>ph√≤ng</button>
        </div>

        <!-- second row -->
        <div class="col-lg-3 col-md-6">
          <label class="form-label">Nh·∫≠n ph√≤ng</label>
          <div class="input-with-icon">
            <input class="form-control" type="date" name="checkIn" value="<%= typeof checkIn !== 'undefined' ? checkIn : '' %>">
            <span class="icon-calendar">üìÖ</span>
          </div>
        </div>

        <div class="col-lg-3 col-md-6">
          <label class="form-label">Tr·∫£ ph√≤ng</label>
          <div class="input-with-icon">
            <input class="form-control" type="date" name="checkOut" value="<%= typeof checkOut !== 'undefined' ? checkOut : '' %>">
            <span class="icon-calendar">üìÖ</span>
          </div>
        </div>

        <div class="col-lg-3 col-md-6">
          <label class="form-label">S·∫Øp x·∫øp</label>
          <select class="form-select" name="sort">
            <option value="priceAsc" <%= sort==='priceAsc' ? 'selected' : '' %>>Gi√° tƒÉng d·∫ßn</option>
            <option value="priceDesc" <%= sort==='priceDesc' ? 'selected' : '' %>>Gi√° gi·∫£m d·∫ßn</option>
            <option value="newest" <%= sort==='newest' ? 'selected' : '' %>>M·ªõi nh·∫•t</option>
          </select>
        </div>

        <div class="col-12">
          <% const hasQuery = (typeof q !== 'undefined' && String(q).trim() !== '') || (typeof type !== 'undefined' && String(type).trim() !== '') || (typeof min !== 'undefined' && String(min).trim() !== '') || (typeof max !== 'undefined' && String(max).trim() !== '') || (typeof checkIn !== 'undefined' && checkIn) || (typeof checkOut !== 'undefined' && checkOut); %>
          <% if (!hasQuery) { %>
            <div class="alert alert-info mt-3">H√£y nh·∫≠p ƒëi·ªÅu ki·ªán v√† b·∫•m <strong>T√¨m ph√≤ng</strong> ƒë·ªÉ hi·ªÉn th·ªã k·∫øt qu·∫£.</div>
          <% } %>
        </div>

      </div>
    </div>
  </form>

  <!-- RESULTS -->
  <% if (typeof rooms !== 'undefined' && rooms && rooms.length > 0) { %>
    <h4 class="mb-3">K·∫øt qu·∫£ (<%= rooms.length %> ph√≤ng)</h4>
    <div class="row g-4">
      <% rooms.forEach(function(room){ 
           let img = room.image || '';
           if (img && img[0] !== '/') img = '/' + img;
      %>
        <div class="col-lg-6">
          <div class="card room-card h-100">
            <a href="/user/room/<%= room._id %>">
              <img src="<%= img || '/images/default-avatar.jpg' %>" class="card-img-top" alt="room image" style="height:260px; object-fit:cover;">
            </a>
            <div class="card-body">
              <a href="/user/room/<%= room._id %>" class="text-decoration-none text-dark">
                <h5 class="card-title mb-1"><%= room.type %> - <%= room.roomNumber || '' %></h5>
              </a>
              <p class="text-primary mb-3"><strong>Gi√°: <%= (room.price || 0).toLocaleString('vi-VN') %> ƒë/ƒë√™m</strong></p>
              <a href="/user/room/<%= room._id %>" class="btn btn-outline-primary w-100">Xem & ƒê·∫∑t</a>
            </div>
          </div>
        </div>
      <% }) %>
    </div>
  <% } %>

</div>

<%- include('partials/footer') %>
